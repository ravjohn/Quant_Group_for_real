---
title: "Assignment 6"
author: "Raveena, Alanna, Jack"
date: "11/29/2021"
output: 
  html_document:
    theme: readable
    toc: true
    toc_depth: 3
    toc_float: true
---

# Research Question
How do food access and demographic characteristics impact mental health on a census tract scale?

# Prior Research
Seligman and Schillinger (2010) posit that food insecurity and chronic disease follows a cyclical pattern where food insecurity leads to chronic disease, thereby increasing medical costs and causing low income households to make trade-offs in spending, often leading to less money available to address food insecurity. Additionally, the results of Jones (2017) suggests that individual food insecurity is associated with poorer mental health and specific psychosocial stressors across global regions independent of socio-ecoomic status.

# Data
The sample population for this study is the full set of all census tracts in the United States, for all people over the age of 18. The analysis will include the following variables:

Categorical

* Access to food options within 1 mile urban or 10 miles rural
* Education, most common attainment per census tract
* Mental Health Outcomes

Continuous

* Percent of households using SNAP
* Poverty rate
* Median income
* Pct households with children
* Age
* Race

# Load Data
```{r, message = FALSE, results = FALSE, warning = FALSE}
library(tidyverse)
library(tidycensus)
library(readxl)
library(knitr)
library(tigris)
library(sf)
library(gridExtra)
library(jtools)
library(interactions)
```


## Load Data Table
```{r, message = FALSE, warning = FALSE}
load(file = "data table.rdata")

data <- data %>%
  mutate(pct_PMH = Data_Value /100) %>%
  subset(select = -c(Data_Value, Data_Value_Unit))
  
kable(head(data))
```
This dataset includes 72,351 census tracts across the United States.

# Descriptive Statistics
## Continuous Variables

### Mental Health
```{r}
MentalHealth_t_test <- t.test(data$pct_PMH)
MentalHealth_quartiles <- quantile(data$pct_PMH, na.rm = TRUE)
MentalHealth_st_dev <- sd(data$pct_PMH, na.rm = TRUE)
MentalHealth_hist <- ggplot(data) +
  geom_histogram(aes(x = pct_PMH),
                 bins = 30)
```

### Percent Households with Children
```{r}
children_t_test <- t.test(data$pct_UnitsWChildren)
children_quartiles <- quantile(data$pct_UnitsWChildren, na.rm = TRUE)
children_st_dev <- sd(data$pct_UnitsWChildren, na.rm = TRUE)
children_hist <- ggplot(data) +
  geom_histogram(aes(x = pct_UnitsWChildren),
                 bins = 30)
```

### Race
```{r}
RWhite_t_test <- t.test(data$pct_RWhite)
RBlack_t_test <- t.test(data$pct_RBlack)
RAI_t_test <- t.test(data$pct_RAI)
RAsian_t_test <- t.test(data$pct_RAsian)
RNH_t_test <- t.test(data$pct_RNH)
ROther_t_test <- t.test(data$pct_ROther)
RTwoPlus_t_test <- t.test(data$pct_RTwoPlus)

RWhite_quartiles <- quantile(data$pct_RWhite, na.rm = TRUE)
RBlack_quartiles <- quantile(data$pct_RBlack, na.rm = TRUE)
RAI_quartiles <- quantile(data$pct_RAI, na.rm = TRUE)
RAsian_quartiles <- quantile(data$pct_RAsian, na.rm = TRUE)
RNH_quartiles <- quantile(data$pct_RNH, na.rm = TRUE)
ROther_quartiles <- quantile(data$pct_ROther, na.rm = TRUE)
RTwoPlus_quartiles <- quantile(data$pct_RTwoPlus, na.rm = TRUE)

RWhite_st_dev <- sd(data$pct_RWhite, na.rm = TRUE)
RBlack_st_dev <- sd(data$pct_RBlack, na.rm = TRUE)
RAI_st_dev <- sd(data$pct_RAI, na.rm = TRUE)
RAsian_st_dev <- sd(data$pct_RAsian, na.rm = TRUE)
RNH_st_dev <- sd(data$pct_RNH, na.rm = TRUE)
ROther_st_dev <- sd(data$pct_ROther, na.rm = TRUE)
RTwoPlus_st_dev <- sd(data$pct_RTwoPlus, na.rm = TRUE)

RWhite_hist <- ggplot(data) +
  geom_histogram(aes(x = pct_RWhite),
                 bins = 30)
RBlack_hist <- ggplot(data) +
  geom_histogram(aes(x = pct_RBlack),
                 bins = 30)
RAI_hist <- ggplot(data) +
  geom_histogram(aes(x = pct_RAI),
                 bins = 30)
RAsian_hist <- ggplot(data) +
  geom_histogram(aes(x = pct_RAsian),
                 bins = 30)
RNH_hist <- ggplot(data) +
  geom_histogram(aes(x = pct_RNH),
                 bins = 30)
ROther_hist <- ggplot(data) +
  geom_histogram(aes(x = pct_ROther),
                 bins = 30)
RTwoPlus_hist <- ggplot(data) +
  geom_histogram(aes(x = pct_RTwoPlus),
                 bins = 30)
```


### Poverty Rate
```{r}
pov_t_test <- t.test(data$PovertyRate)
pov_quartiles <- quantile(data$PovertyRate, na.rm = TRUE)
pov_st_dev <- sd(data$PovertyRate, na.rm = TRUE)
pov_hist <- ggplot(data) +
  geom_histogram(aes(x = PovertyRate),
                 bins = 30)
```


### Percent Households using SNAP
```{r}
SNAP_t_test <- t.test(data$pct_SNAP)
SNAP_quartiles <- quantile(data$pct_SNAP, na.rm = TRUE)
SNAP_st_dev <- sd(data$pct_SNAP, na.rm = TRUE)
SNAP_hist <- ggplot(data) +
  geom_histogram(aes(x = pct_SNAP),
                 bins = 30)
```

### Median Income
```{r}
income_t_test <- t.test(data$MedIncomeE)
income_quartiles <- quantile(data$MedIncomeE, na.rm = TRUE)
income_st_dev <- sd(data$MedIncomeE, na.rm = TRUE)
income_hist <- ggplot(data) +
  geom_histogram(aes(x = MedIncomeE),
                 bins = 30)
```


### Age
```{r}
age_t_test <- t.test(data$MedAge)
age_quartiles <- quantile(data$MedAge, na.rm = TRUE)
age_st_dev <- sd(data$MedAge, na.rm = TRUE)
age_hist <- ggplot(data) +
  geom_histogram(aes(x = MedAge),
                 bins = 30)
```


### Results for Continuous Variables
```{r, warning = FALSE}
cont_summary <- tibble(
  Variable = c("% Households with Children", "% White", "% Black", "% AI/AN", "% Asian", "% Hawaiian", "% Other", "% Two or More", "Median Age","Poverty Rate", "Percent Households SNAP", "Median Income", "Pct of Census Tract with Poor Mental Health for 14 days or more"),
  `Sample mean` = c(children_t_test$estimate * 100,
                    RWhite_t_test$estimate * 100,
                    RBlack_t_test$estimate * 100,
                    RAI_t_test$estimate * 100,
                    RAsian_t_test$estimate * 100,
                    RNH_t_test$estimate * 100,
                    ROther_t_test$estimate * 100,
                    RTwoPlus_t_test$estimate * 100,
                    age_t_test$estimate,
                    pov_t_test$estimate,
                    SNAP_t_test$estimate *100,
                    income_t_test$estimate,
                    MentalHealth_t_test$estimate * 100),
  `Population mean (95% confidence) - low` = 
    c(children_t_test$conf.int[1] * 100,
                    RWhite_t_test$conf.int[1] * 100,
                    RBlack_t_test$conf.int[1] * 100,
                    RAI_t_test$conf.int[1] * 100,
                    RAsian_t_test$conf.int[1] * 100,
                    RNH_t_test$conf.int[1] * 100,
                    ROther_t_test$conf.int[1] * 100,
                    RTwoPlus_t_test$conf.int[1]* 100,
                    age_t_test$conf.int[1],
                    pov_t_test$conf.int[1],
                    SNAP_t_test$conf.int[1] *100,
                    income_t_test$conf.int[1],
                    MentalHealth_t_test$conf.int[1]*100),
  `Population mean (95% confidence) - high` =
      c(children_t_test$conf.int[2] * 100,
                    RWhite_t_test$conf.int[2] * 100,
                    RBlack_t_test$conf.int[2] * 100,
                    RAI_t_test$conf.int[2] * 100,
                    RAsian_t_test$conf.int[2] * 100,
                    RNH_t_test$conf.int[2] * 100,
                    ROther_t_test$conf.int[2] * 100,
                    RTwoPlus_t_test$conf.int[2] * 100,
                    age_t_test$conf.int[2],
                    pov_t_test$conf.int[2],
                    SNAP_t_test$conf.int[2] *100,
                    income_t_test$conf.int[2],
                    MentalHealth_t_test$conf.int[2]),
    Median = c(children_quartiles[3] * 100,
                    RWhite_quartiles[3] * 100,
                    RBlack_quartiles[3] * 100,
                    RAI_quartiles[3] * 100,
                    RAsian_quartiles[3] * 100,
                    RNH_quartiles[3] * 100,
                    ROther_quartiles[3] * 100,
                    RTwoPlus_quartiles[3]*100,
                    age_quartiles[3],
                    pov_quartiles[3],
                    SNAP_quartiles[3] *100,
                    income_quartiles[3],
                    MentalHealth_quartiles[3] *100),
    `Interquartile range` = c((children_quartiles[4] - children_quartiles[2]) * 100,
                              (RWhite_quartiles[4] - RWhite_quartiles[2]) * 100,
                              (RBlack_quartiles[4] - RBlack_quartiles[2]) * 100,
                              (RAI_quartiles[4] - RAI_quartiles[2]) * 100,
                              (RAsian_quartiles[4] - RAsian_quartiles[2]) * 100,
                              (RNH_quartiles[4] - RNH_quartiles[2]) * 100,
                              (ROther_quartiles[4] - ROther_quartiles[2]) * 100,
                              (RTwoPlus_quartiles[4] - RTwoPlus_quartiles[2]) * 100,
                              age_quartiles[4] - age_quartiles[2],
                              pov_quartiles[4] - pov_quartiles[2],
                              (SNAP_quartiles[4] - SNAP_quartiles[2]) *100,
                               income_quartiles[4] - income_quartiles[2],
                              (MentalHealth_quartiles[4] - MentalHealth_quartiles[2]) *100),
   `Standard deviation` = c(children_st_dev * 100,
                            RWhite_st_dev * 100,
                            RBlack_st_dev * 100,
                            RAI_st_dev * 100,
                            RAsian_st_dev * 100,
                            RNH_st_dev * 100,
                            ROther_st_dev * 100,
                            RTwoPlus_st_dev * 100,
                            age_st_dev,
                            pov_st_dev,
                            SNAP_st_dev,
                            income_st_dev,
                            MentalHealth_st_dev * 100))

kable(cont_summary, digits = 0)
```

```{r warning = FALSE}
pretty_children_hist <- children_hist +
  theme_bw() +
  scale_x_continuous(name = "% Households with Children") +
  scale_y_continuous(name = "Number of census tracts") +
  theme(text = element_text(size=6),axis.text.x = element_text(angle = 90))

pretty_RWhite_hist <- RWhite_hist +
  theme_bw() +
  scale_x_continuous(name = "% White Only") +
  scale_y_continuous(name = "Number of census tracts") +
  theme(text = element_text(size=6),axis.text.x = element_text(angle = 90))

pretty_RBlack_hist <- RBlack_hist +
  theme_bw() +
  scale_x_continuous(name = "% Black Only") +
  scale_y_continuous(name = "Number of census tracts") +
  theme(text = element_text(size=6),axis.text.x = element_text(angle = 90))

pretty_RAI_hist <- RAI_hist +
  theme_bw() +
  scale_x_continuous(name = "% AI/AN Only") +
  scale_y_continuous(name = "Number of census tracts") +
  theme(text = element_text(size=6),axis.text.x = element_text(angle = 90))

pretty_RAsian_hist <- RAsian_hist +
  theme_bw() +
  scale_x_continuous(name = "% Asian Only") +
  scale_y_continuous(name = "Number of census tracts") +
  theme(text = element_text(size=6),axis.text.x = element_text(angle = 90))

pretty_RNH_hist <- RNH_hist +
  theme_bw() +
  scale_x_continuous(name = "% Hawiian Only") +
  scale_y_continuous(name = "Number of census tracts") +
  theme(text = element_text(size=6),axis.text.x = element_text(angle = 90))

pretty_ROther_hist <- ROther_hist +
  theme_bw() +
  scale_x_continuous(name = "% Other") +
  scale_y_continuous(name = "Number of census tracts") +
  theme(text = element_text(size=6),axis.text.x = element_text(angle = 90))

pretty_RTwoPlus_hist <- RTwoPlus_hist +
  theme_bw() +
  scale_x_continuous(name = "% Two or More") +
  scale_y_continuous(name = "Number of census tracts") +
  theme(text = element_text(size=6),axis.text.x = element_text(angle = 90))

pretty_age_hist <- age_hist +
  theme_bw() +
  scale_x_continuous(name = "Median Age") +
  scale_y_continuous(name = "Number of census tracts") +
  theme(text = element_text(size=6),axis.text.x = element_text(angle = 90))

pretty_pov_hist <- pov_hist +
  theme_bw() +
  scale_x_continuous(name = "Median Poverty Rate") +
  scale_y_continuous(name = "Number of Census Tracks") +
  theme(text = element_text(size=6),axis.text.x = element_text(angle = 90))

pretty_SNAP_hist <- SNAP_hist +
  theme_bw() +
  scale_x_continuous(name = "Percent Households SNAP") +
  scale_y_continuous(name = "Number of Census Tracts") +
  theme(text = element_text(size=6),axis.text.x = element_text(angle = 90))

pretty_income_hist = income_hist +
  theme_bw() +
  scale_x_continuous(name = "Median Income") +
  scale_y_continuous(name = "Number of Census Tracts") +
  theme(text = element_text(size=6), axis.text.x = element_text(angle = 90)) 

pretty_MentalHealth_hist <- MentalHealth_hist +
  theme_bw() +
  scale_x_continuous(name = "Percent of Adults Reporting Negative\n Mental Health for 14+ days") +
  scale_y_continuous(name = "Number of Census Tracks") +
  theme(text = element_text(size=6),axis.text.x = element_text(angle = 90))

grid.arrange(pretty_children_hist, pretty_RWhite_hist, pretty_RBlack_hist, pretty_RAI_hist, pretty_RAsian_hist, pretty_ROther_hist, pretty_RTwoPlus_hist, pretty_age_hist, pretty_pov_hist, pretty_SNAP_hist, pretty_income_hist, pretty_MentalHealth_hist,
             ncol = 3)
```


## Categorical Variables

### Access to food options within 1 mile urban or 10 miles rural
```{r}
pct_access <- t.test(data$LA1and10 == "0")
pct_noaccess <-  t.test(data$LA1and10 == "1")
```

### Display Access to food options within 1 mile urban or 10 miles rural
```{r}
cat_summary_access <- tibble(`Access to Food` = 
                              c("Access",
                                "No Access"),
                            `Sample proportion` = 
                              c(pct_access$estimate * 100,
                                pct_noaccess$estimate *100),
                            `95-percent confidence - low` = 
                              c(pct_access$conf.int[1] * 100,
                                pct_noaccess$conf.int[1] * 100),
                            `95-percent confidence - high` = 
                              c(pct_access$conf.int[2] * 100,
                                pct_noaccess$conf.int[2] * 100))

kable(cat_summary_access, digits = 0)

ggplot(cat_summary_access) +
  geom_bar(aes(x = `Access to Food`, 
               y = `Sample proportion`),
           stat = "identity") +
  geom_errorbar(aes(x = `Access to Food`, 
               y = `Sample proportion`,
               ymin = `95-percent confidence - low`,
               ymax = `95-percent confidence - high`),
           stat = "identity") +
  scale_y_continuous(name = "Percent of Census Tracts",
                     breaks = c(0, 20, 40, 60, 80),
                     labels = c("0", "20%", "40%", "60%", "80%")) +
  theme_bw()
```

### Education
```{r}
pct_EdHS <- t.test(data$MaxEd == "High School")
pct_EdGED <- t.test(data$MaxEd == "GED")
pct_EdAssociates <- t.test(data$MaxEd == "Associates")
pct_EdBachelors <- t.test(data$MaxEd == "Bachelors")
pct_EdMasters <- t.test(data$MaxEd == "Masters")
pct_EdProfessional <- t.test(data$MaxEd == "Professional")
pct_EdDoctorate <- t.test(data$MaxEd == "Doctorate")
```

### Display Education
```{r}
cat_summary_Ed <- tibble(`Educational Attainment` = 
                              c("High School",
                                "GED",
                                "Associates",
                                "Bachelors",
                                "Masters",
                                "Professional",
                                "Doctorate"),
                            `Sample proportion` = 
                              c(pct_EdHS$estimate * 100,
                                pct_EdGED$estimate * 100,
                                pct_EdAssociates$estimate * 100,
                                pct_EdBachelors$estimate * 100,
                                pct_EdMasters$estimate * 100,
                                pct_EdProfessional$estimate * 100,
                                pct_EdDoctorate$estimate * 100),
                            `95-percent confidence - low` = 
                              c(pct_EdHS$conf.int[1] * 100,
                                pct_EdGED$conf.int[1] * 100,
                                pct_EdAssociates$conf.int[1] * 100,
                                pct_EdBachelors$conf.int[1] * 100,
                                pct_EdMasters$conf.int[1] * 100,
                                pct_EdProfessional$conf.int[1] * 100,
                                pct_EdDoctorate$conf.int[1] * 100),
                            `95-percent confidence - high` = 
                              c(pct_EdHS$conf.int[2] * 100,
                                pct_EdGED$conf.int[2] * 100,
                                pct_EdAssociates$conf.int[2] * 100,
                                pct_EdBachelors$conf.int[2] * 100,
                                pct_EdMasters$conf.int[2] * 100,
                                pct_EdProfessional$conf.int[2] * 100,
                                pct_EdDoctorate$conf.int[2] * 100))

kable(cat_summary_Ed, digits = 0)

ggplot(cat_summary_Ed) +
  geom_bar(aes(x = `Educational Attainment`, 
               y = `Sample proportion`),
           stat = "identity") +
  geom_errorbar(aes(x = `Educational Attainment`, 
               y = `Sample proportion`,
               ymin = `95-percent confidence - low`,
               ymax = `95-percent confidence - high`),
           stat = "identity") +
  scale_y_continuous(name = "Percent of census tracts",
                     breaks = c(0, 20, 40, 60, 80),
                     labels = c("0", "20%", "40%", "60%", "80%")) +
  theme_bw()
```

# Bivariate Analysis
The continuous variable we are testing as dependent is mental health.

## Continuous-Continuous Correlation Test

### Age
```{r}
cor.test(~ pct_PMH + MedAge, data = data)

age_model <- lm(pct_PMH ~ MedAge, data = data)
```
The correlation for mental health and median age is -0.4883118 and the 95% confidence interval is below zero. We can say with 95% confidence that an increase in median age correlates with an decrease in poor mental health outcomes.

### Median Income
```{r}
cor.test(~ pct_PMH + MedIncomeE, data = data)

MedIncome_model <- lm(pct_PMH ~ MedIncomeE, data = data)

```
The correlation for mental health and median income is -0.7605683 and the 95% confidence interval is below zero. This indicates we can say with 95% that there is a negative correlation between mental health and median incom. As the median income increases within a census track, the percent of adults reporting poor mental health decreases. 


### Poverty Rate
```{r}
cor.test(~ pct_PMH + PovertyRate, data = data)

MedIncome_model <- lm(pct_PMH ~ PovertyRate, data = data)

```

The correlation for mental health and poverty rate is 0.8124621 and the 95% confidence interval is above zero. This indicates we can say with 95% that there is a correlation between mental health and a census track's poverty rate. As the percent of poverty increases, so does the percent of adults reporting poor mental health.  


### Percent of Households using SNAP
```{r}
cor.test(~ pct_PMH + pct_SNAP, data = data)

SNAP_model <- lm(pct_PMH ~ pct_SNAP, data = data)
```
The correlation for mental health and percent of households using SNAP is 0.6922096, and the 95% confidence interval is above zero. We can say with 95% confidence that an increase in households using SNAP correlates with an increase in poor mental health outcomes.

### Percent of Households with Children
```{r}
cor.test(~ pct_PMH + pct_UnitsWChildren, data = data)

UnitsWChildren_model <- lm(pct_PMH ~ pct_UnitsWChildren, data = data)
```
The correlation for poor mental health and percent of homes with children is 0.1768382 and the 95% confidence interval is all positive numbers, which means we can say with 95% certainty that there is an increase in percent of people with poor mental health days as the percent of homes with children in a census tract increases. The p-value is 2.2e-16 (the lowest number R will provide), which means it is very unlikely this pattern would appear if the variables were not correlated. 

### Race
```{r}

RWhite_corr <- cor.test(~ pct_PMH + pct_RWhite, data = data)
RBlack_corr <- cor.test(~ pct_PMH + pct_RBlack, data = data)
RAI_corr <- cor.test(~ pct_PMH + pct_RAI, data = data)
RAsian_corr <- cor.test(~ pct_PMH + pct_RAsian, data = data)
RNH_corr <- cor.test(~ pct_PMH + pct_RNH, data = data)
ROther_corr <- cor.test(~ pct_PMH + pct_ROther, data = data)
RTwoPlus_corr <- cor.test(~ pct_PMH + pct_RTwoPlus, data = data)

Race_corr_summary <- tibble(`Race` = 
                              c("White",
                                "Black",
                                "AI/AN",
                                "Asian",
                                "Hawiian",
                                "Other",
                                "Two or More"),
                            `Correlation Estimate` =
                              c(RWhite_corr$estimate,
                                RBlack_corr$estimate,
                                RAI_corr$estimate,
                                RAsian_corr$estimate,
                                RNH_corr$estimate,
                                ROther_corr$estimate,
                                RTwoPlus_corr$estimate),
                            `95% Confidence Interval, low` =
                               c(RWhite_corr$conf.int[1],
                                RBlack_corr$conf.int[1],
                                RAI_corr$conf.int[1],
                                RAsian_corr$conf.int[1],
                                RNH_corr$conf.int[1],
                                ROther_corr$conf.int[1],
                                RTwoPlus_corr$conf.int[1]),
                            `95% Confidence Interval, high` =
                               c(RWhite_corr$conf.int[2],
                                RBlack_corr$conf.int[2],
                                RAI_corr$conf.int[2],
                                RAsian_corr$conf.int[2],
                                RNH_corr$conf.int[2],
                                ROther_corr$conf.int[2],
                                RTwoPlus_corr$conf.int[2]),                                                        `p-value` =
                                c(RWhite_corr$p.value,
                                  RBlack_corr$p.value,
                                  RAI_corr$p.value,
                                  RAsian_corr$p.value,
                                  RNH_corr$p.value,
                                  ROther_corr$p.value,
                                  RTwoPlus_corr$p.value))

kable(Race_corr_summary)

RWhite_model <- lm(pct_PMH ~ pct_RWhite, data = data)
RBlack_model <- lm(pct_PMH ~ pct_RBlack, data = data)
RAI_model <- lm(pct_PMH ~ pct_RAI, data = data)
RAsian_model <- lm(pct_PMH ~ pct_RAsian, data = data)
RNH_model <- lm(pct_PMH ~ pct_RNH, data = data)
ROther_model <- lm(pct_PMH ~ pct_ROther, data = data)
RTwoPlus_model <- lm(pct_PMH ~ pct_RTwoPlus, data = data)
```
The results of correlation tests between the percent of poor mental health days and the racial demographic data are summarized in this table. All p values are low enough to be 95% confident in the correlation of racial demographics and mental health reporting. The confidence interval values for each variable are either both negative or both positive, so the correlation estimate cannot be zero within 95% confidence. Correlation estimates are positive for American Indian & Alaska Native, Asian, and Two or More, meaning as the percentages of these populations increase within a census tract the percentage of individuals experiencing poor mental health days is expected to increase. Correlation estimates are negative for White, Black, Native Hawaiian, and Other, meaning poor mental health days decrease as the percentage of these populations increase. It is worth noting here that the Two or More and Other categories are broad enough to provide little value to this analysis, but we have included them out of curiosity.


## Continuous-Categorical Difference in Means Test

### Access to Food Options
```{r}
FoodAccess_model <- lm(pct_PMH ~ LA1and10, data = data)
summary(FoodAccess_model)

```
The p-value for mental health and food access is < 2.2e-16, the lowest p value amount, indicating the relationship is significant and the confidence intervals are both 95%. The correlation estimate is negative indicating we can expect both urban and rural census blocks with access to food* to have a lower percentage of adults reporting poor mental health. 

*The USDA defines urban census blocks within 1 mile of food and rural census blocks within 10 miles of food as having food access.

### Education
```{r}
data <- data %>%
  mutate(MaxEd = as.factor(MaxEd)) %>%
  mutate(MaxEd = relevel(MaxEd, "High School"))

MaxEd_model <- lm(pct_PMH ~ MaxEd, data)

summary(MaxEd_model)
```
The most common educational attainment among the census tracts is high school, so this analysis uses high school as the baseline of comparison for the other categorical values. All variables have low p-values, so the confidence intervals are 95% for each. The categories of high school, associates, and GED have positive correlation estimates, census tracts in which these are the most common educational attainment are likely to have higher rates of poor mental health. Conversely, bachelors, masters, professional, and doctorate degrees have negative correlation estimates, so poor mental health rates are expected to decrease in tracts in which these are the most commonly attained levels of education.

# Multivariate Regression
```{r}
full_model <- lm(pct_PMH ~ pct_SNAP + PovertyRate + MedIncomeE + MedAge + pct_UnitsWChildren + pct_RWhite + pct_RBlack + pct_RAI + pct_RAsian + pct_RNH + pct_RTwoPlus+ LA1and10 + MaxEd, data)

summary(full_model)
```

## Overview
We ran a multivariate linear regression of the independent variables in this analysis to examine their effects on the percent of people experiencing fourteen or more poor mental health days per year, across the United States at the scale of the census tract. The independent variables included are percent of population utilizing SNAP benefits, poverty rate, median income, median age, percent of households with children, if the census tract has high access to food (based on 1 mile for urban areas and 10 miles for rural areas), the most common highest educational attainment within the census tract, and the percent of population that identify as one of the following racial categories: white, Black, American Indian/Alaska Native, Asian, Native Hawiian, or two or more. The racial category of “other” was excluded from the regression to avoid a singularity, since all of the racial categories would add up to 100%. This would yield multicollinearity such that the regression would not be completed for all racial demographic variables. We chose to exclude “other” since it revealed the least information, as it is the broadest grouping within this part of the census.

Of the independent variables included, all but the Professional Degree education category are significant within the 95% confidence interval. The High School education category and Native Hawiian racial percentage are significant, but have p-values of 0.031512 and 0.002276, respectively, which are much closer to the 95% interval than the other variables. SNAP usage, poverty rate, median income, median age, percent of households with children, and tracts where a Bachelor’s degree is the most common level of educational attainment are the variables with the lowest p-values, as close to 0 as R will compute.

The model's R squared value is 0.843, so this combination of independent variables explains 84% of the variation in percent of population experiencing poor mental health for more than 14 days. This is a high R squared value, which could suggest that poor mental health is well predicted by the independent variables we included in this regression. Other independent variables to consider including to explain the remaining variation could be homeownership rates, physical health outcomes, and health care access.


## Positive Correlation:
The following summary assumes that all other variables are held constant, except for the independent variable in question:

A 1% increase in SNAP utilization is associated with a 0.0177% increase in the percent of adults experiencing poor mental health for more than 14 days. SNAP is a food stamp program that assists low-income individuals, so higher SNAP utilization may indicate lower financial security resulting in poor mental health.

A 1% increase in Poverty Rate is associated with a 0.001386% increase in the percent of adults experiencing poor mental health for more than 14 days. This increase in Poverty Rate indicates lower financial security that also results in poor mental health.

A 1% increase in Units with Children is associated with a 0.02198% increase in the percent of adults experiencing poor mental health for more than 14 days. Units with children may present lower financial security given the additional mouths to feed and children to care for, resulting in poor mental health.

A 1% increase in a census tract’s Black population is associated with a 0.03217% increase in the percent of adults experiencing poor mental health for more than 14 days. A 1% increase in a census tract’s American Indian population is associated with a 0.02668% increase in the percent of adults experiencing poor mental health for more than 14 days. A 1% increase in a census tract’s Asian population is associated with a 0.05773% increase in the percent of adults experiencing poor mental health for more than 14 days. Racial discrimination and systemic racism towards non-white individuals can contribute to higher levels of hypertension and stress, so this logically results in more adults experiencing poor mental health.

For categorical variables, the baseline intercept includes census tracts that have a majority highest level of education being Associate's Degrees and have limited food access (based on the USDA).

Census tracts with the majority highest education level being GED have 0.008068% more adults experiencing poor mental health for more than 14 days compared to the baseline intercept. Census tracts with the majority highest education level being High School have 0.00226% more adults experiencing poor mental health for more than 14 days compared to the baseline intercept. These two degree types are the lowest attainable levels of education in the census and could result in lower income overall, meaning that financial security is lower and negatively impacts mental health.

The estimate for Professional Degrees is 0.00729%, but it is not statistically significant. 


## Negative Correlation: 
The following summary assumes that all other variables are held constant, except for the independent variable in question:

A 1 dollar increase in median income is associated with a decrease in adults reporting poor mental health for more than 14 days by 0.0000006253%. This indicates households with a higher median income have greater financial security which likely reduces the burden of stressors that impact mental health. In other words, a census tract with a median income $10,000,000 higher than another tract would be expected to have a 6.253% lower rate in adults reporting poor mental health. This independent variable has the smallest magnitude estimate, which means it does not influence poor mental health rate as much as the other variables.

A 1 year increase in median age is associated with a decrease in adults reporting poor mental health for more than 14 days by 0.0009363%. A 1% increase in a census tract’s white population is associated with a decrease in adults reporting poor mental health for more than 14 days by 0.06413%. A 1%  increase in a census tract’s Native Hawaiian population is associated with a decrease in adults reporting poor mental health for more than 14 days by 0.02243%. A 1% increase in a census tract’s population of two or more races is associated with a decrease in adults reporting poor mental health for more than 14 days by 0.02564%. 

For categorical variables, the baseline intercept includes census tracts that have a majority highest level of education being Associate's Degrees and have limited food access (based on the USDA).

With respect to a census tract without food access (as defined by the USDA), census tract with food access are associated with a decrease in adults reporting poor mental health for more than 14 days by 0.0007844%. Being in close proximity to reliable food sources reduces the stress and challenges associated with procuring food which can contribute to better nutrition to support both physical and mental health. However in the context of this study, the estimate is the second smallest suggesting that the distance aspect of food access does not have a strong influence on mental health outcomes in adults. This does not mean other components of food access do not influence mental health outcomes, such as quality, transportation, and affordability.

Census tracts with the majority highest educational attainment being a bachelor's degree are associated with a decrease in adults reporting poor mental health for more than 14 days by 0.009712%. Census tracts with the majority highest educational attainment being a doctorate degree are associated with a decrease in adults reporting poor mental health for more than 14 days by  0.01573%. Census tracts with the majority highest educational attainment being a masters degree are associated with a decrease in adults reporting poor mental health for more than 14 days by 0.009295%. These degrees are the highest levels of educational attainment which suggests these census tracts likely also have higher incomes and greater financial security, both factors that could reduce the likelihood of persisting poor mental health in adults.

# Transformations
```{r}
coeff_names <- c("Constant" = "(Intercept)",
                 "SNAP Utilization" = "pct_SNAP",
                 "Poverty Rate" = "PovertyRate",
                 "Median Age" = "MedAge",
                 "Median Income" = "MedIncomeE",
                 "Doubling Median Income" = "log2_MedIncome",
                 "% Units with Children" = "pct_UnitsWChildren",
                 "% White" = "pct_RWhite",
                 "% Black" = "pct_RBlack",
                 "% AI" = "pct_RAI",
                 "% Asian" = "pct_RAsian",
                 "% NH" = "pct_RNH",
                 "% Two Plus Races" = "pct_RTwoPlus",
                 "Access to Food (1 Mile Urban and 10 Miles Rural)" = "LA1and10")

scaled_data <- data %>%
  mutate(pct_SNAP = pct_SNAP / 100,
         PovertyRate = PovertyRate / 100,
         MedIncomeE = MedIncomeE / 1000000,
         MedAge = MedAge / 10,
         pct_UnitsWChildren = pct_UnitsWChildren / 100,
         pct_RWhite = pct_RWhite / 100,
         pct_RBlack = pct_RBlack / 100,
         pct_RAI = pct_RAI / 100,
         pct_RAsian = pct_RAsian / 100,
         pct_RNH = pct_RNH / 100,
         pct_RTwoPlus = pct_RTwoPlus / 100)

scaled_model <- lm(pct_PMH ~ pct_SNAP + PovertyRate + MedIncomeE + MedAge + pct_UnitsWChildren + pct_RWhite + pct_RBlack + pct_RAI + pct_RAsian + pct_RNH + pct_RTwoPlus+ LA1and10 + MaxEd, scaled_data)

scaled_data_medIncome_log <- scaled_data %>%
  mutate(log2_MedIncome = log(MedIncomeE, base = 2))
              

scaled_MedIncome_model_log <- lm(pct_PMH ~ pct_SNAP + PovertyRate + log2_MedIncome + MedAge + pct_UnitsWChildren + pct_RWhite + pct_RBlack + pct_RAI + pct_RAsian + pct_RNH + pct_RTwoPlus+ LA1and10 + MaxEd, data = scaled_data_medIncome_log)


export_summs(full_model, scaled_model, scaled_MedIncome_model_log,
             error_format = "(p = {p.value})",
             error_pos = "same",
             model.names = c("Initial", 
                             "Scaled Data",
                             "Median Income Logged"),
             coefs = coeff_names)
```

We first scaled the continuous variables to represent whole numbers rather than percentages and to represent age by decades and median income by units of one million. This transformed the coefficient to be more legible in the context of the tables.

The second transformation took the base 2 log of median income, which increased the R-squared value from 0.84 to 0.85. This nominal difference is a slightly better fit for the model.

# Interactions

## Alanna
Testing interaction between pct_SNAP and MaxEd on the relationship with Poor Mental Health
```{r}

coeff_names_interaction <- c("Constant" = "(Intercept)",
                 "SNAP Utilization" = "pct_SNAP",
                 "Poverty Rate" = "PovertyRate",
                 "Median Age" = "MedAge",
                 "Median Income" = "MedIncomeE",
                 "Doubling Median Income" = "log2_MedIncome",
                 "% Units with Children" = "pct_UnitsWChildren",
                 "% White" = "pct_RWhite",
                 "% Black" = "pct_RBlack",
                 "% AI" = "pct_RAI",
                 "% Asian" = "pct_RAsian",
                 "% NH" = "pct_RNH",
                 "% Two Plus Races" = "pct_RTwoPlus",
                 "Access to Food (1 Mile Urban and 10 Miles Rural)" = "LA1and10")
                   
                   
interaction_SNAP_ED_model <- lm(pct_PMH ~ pct_SNAP + PovertyRate + log2_MedIncome + MedAge + pct_UnitsWChildren + pct_RWhite + pct_RBlack + pct_RAI + pct_RAsian + pct_RNH + pct_RTwoPlus+ LA1and10 + MaxEd + pct_SNAP*MaxEd, data = scaled_data_medIncome_log)

export_summs(scaled_MedIncome_model_log, interaction_SNAP_ED_model,
             error_format = "(p = {p.value})",
             error_pos = "same",
             model.names = c("Median Income Logged",
                             "SNAP and Ed Interaction"))

```
PLOT. X axis labels not showing and not sure PMH is showing up correctly?
```{r}

interact_plot(interaction_SNAP_ED_model, pred = pct_SNAP, modx = MaxEd,
              interval = TRUE) +
  scale_x_continuous(breaks = breaks <- c(-2, -1, 0, 1, 2),
                     labels = round(breaks * 10 + mean(data$pct_SNAP, na.rm = TRUE)),
                     name = "SNAP Utilization") +
  scale_y_continuous(name = "Percent of Adults Experiencing Poor\n Mental Health 14 days or more")

```

Testing interaction between pct_SNAP and pct_UnitsWChildren on the relationship with Poor Mental Health
```{r}
interaction_SNAP_Child_model <- lm(pct_PMH ~ pct_SNAP + PovertyRate + log2_MedIncome + MedAge + pct_UnitsWChildren + pct_RWhite + pct_RBlack + pct_RAI + pct_RAsian + pct_RNH + pct_RTwoPlus+ LA1and10 + MaxEd + pct_SNAP*pct_UnitsWChildren, data = scaled_data_medIncome_log)

export_summs(scaled_MedIncome_model_log, interaction_SNAP_Child_model,
             error_format = "(p = {p.value})",
             error_pos = "same",
             model.names = c("Median Income Logged",
                             "SNAP and Children Interaction"))



```
PLOT.
```{r}

interact_plot(interaction_SNAP_Child_model, pred = pct_SNAP, modx = pct_UnitsWChildren,
              interval = TRUE) +
  scale_x_continuous(breaks = breaks <- c(-2, -1, 0, 1, 2),
                     labels = round(breaks * 10 + mean(data$pct_SNAP, na.rm = TRUE)),
                     name = "SNAP Utilization") +
  scale_y_continuous(name = "Percent of Adults Experiencing Poor\n Mental Health 14 days or more")


```


## Jack
Testing relationship between median income and poor mental health change depending on access to food within 1 mile urban and 10 mile rural?
```{r}
coeff_names_interaction <- c("Constant" = "(Intercept)",
                 "SNAP Utilization" = "pct_SNAP",
                 "Poverty Rate" = "PovertyRate",
                 "Median Age" = "MedAge",
                 "Median Income" = "MedIncomeE",
                 "Doubling Median Income" = "log2_MedIncome",
                 "% Units with Children" = "pct_UnitsWChildren",
                 "% White" = "pct_RWhite",
                 "% Black" = "pct_RBlack",
                 "% AI" = "pct_RAI",
                 "% Asian" = "pct_RAsian",
                 "% NH" = "pct_RNH",
                 "% Two Plus Races" = "pct_RTwoPlus",
                 "Access to Food (1 Mile Urban and 10 Miles Rural)" = "LA1and10")
                   
                   
interaction_income_access_model <- lm(pct_PMH ~ pct_SNAP + PovertyRate + log2_MedIncome + MedAge + pct_UnitsWChildren + pct_RWhite + pct_RBlack + pct_RAI + pct_RAsian + pct_RNH + pct_RTwoPlus+ LA1and10 + MaxEd + log2_MedIncome*LA1and10, data = scaled_data_medIncome_log)

export_summs(scaled_MedIncome_model_log, interaction_income_access_model,
             error_format = "(p = {p.value})",
             error_pos = "same",
             model.names = c("Median Income Logged",
                             "Income and Access Interaction"))

interact_plot(interaction_income_access_model, pred = log2_MedIncome, modx = LA1and10,
              interval = TRUE) +
  scale_x_continuous(breaks = breaks <- c(-2, -1, 0, 1, 2),
                     labels = round(breaks * 10 + mean(data(MedIncomeE), na.rm = TRUE)),
                     name = "Median income") +
  scale_y_continuous(name = "Percent of Adults Experiencing Poor\n Mental Health 14 days or more")

```

Graph it! X legend not working...???
```{r}
interact_plot(interaction_income_access_model, pred = log2_MedIncome, modx = LA1and10,
              interval = TRUE) +
  scale_x_continuous(breaks = breaks <- c(-2, -1, 0, 1, 2),
                     labels = round(breaks * 10 + mean(data(MedIncomeE), na.rm = TRUE)),
                     name = "Median income") +
  scale_y_continuous(name = "Percent of Adults Experiencing Poor\n Mental Health 14 days or more")
```

## Raveena
``` {r}
coeff_names_interaction <- c("Constant" = "(Intercept)",
                 "SNAP Utilization" = "pct_SNAP",
                 "Poverty Rate" = "PovertyRate",
                 "Median Age" = "MedAge",
                 "Median Income" = "MedIncomeE",
                 "Doubling Median Income" = "log2_MedIncome",
                 "% Units with Children" = "pct_UnitsWChildren",
                 "% White" = "pct_RWhite",
                 "% Black" = "pct_RBlack",
                 "% AI" = "pct_RAI",
                 "% Asian" = "pct_RAsian",
                 "% NH" = "pct_RNH",
                 "% Two Plus Races" = "pct_RTwoPlus",
                 "Access to Food (1 Mile Urban and 10 Miles Rural)" = "LA1and10")
                   
                   
interaction_SNAP_access_model <- lm(pct_PMH ~ pct_SNAP + PovertyRate + log2_MedIncome + MedAge + pct_UnitsWChildren + pct_RWhite + pct_RBlack + pct_RAI + pct_RAsian + pct_RNH + pct_RTwoPlus+ LA1and10 + MaxEd + pct_SNAP*LA1and10, data = scaled_data_medIncome_log)

export_summs(scaled_MedIncome_model_log, interaction_SNAP_access_model,
             error_format = "(p = {p.value})",
             error_pos = "same",
             model.names = c("Percent SNAP",
                             "Income and Access Interaction"))

interact_plot(interaction_SNAP_access_model, pred = pct_SNAP, modx = LA1and10,
              interval = TRUE) +
  scale_x_continuous(breaks = breaks <- c(-2, -1, 0, 1, 2),
                     labels = round(breaks * 10 + mean(data(MedIncomeE), na.rm = TRUE)),
                     name = "Percent SNAP Usage") +
  scale_y_continuous(name = "Percent of Adults Experiencing Poor\n Mental Health 14 days or more")
```



# References
Ahern, Melissa, Brown, Cheryl, Dukas, Stephen. "A National Study of the Association Between Food Environments and County-Level Health Outcomes." The Journal of Rural Health 27, no. 4 (2011): 367-379. doi: https://doi.org/10.1111/j.1748-0361.2011.00378.x

Centers for Disease Control and Prevention, "Census Tract Level State Maps of the Modified Retail Food Environment Index (mRFEI)" https://www.cdc.gov/obesity/downloads/census-tract-level-state-maps-mrfei_TAG508.pdf

Centers for Disease Control and Prevention, "PLACES: Local Data for Better Health, Census Tract Data 2020 release".
https://chronicdata.cdc.gov/500-Cities-Places/PLACES-Local-Data-for-Better-Health-Census-Tract-D/cwsq-ngmh

Jones, Andrew D."Food Insecurity and Mental Health Status: A Global Analysis of 149 Countries." American Journal of Preventative Medicine 53, no. 2 (2017): 264-273. doi: https://doi.org/10.1016/j.amepre.2017.04.008

Kaiser ML, Dionne J, Carr JK. "Predictors of Diet-Related Health Outcomes in Food-Secure and Food-Insecure Communities." Soc Work Public Health 34, no.3 (2019):214-229. doi: 10.1080/19371918.2019.1575313. Epub 2019 Feb 15. PMID: 30767652.

Seligman, Hilary K., and Dean Schillinger. "Hunger and Socioeconomic Disparities in Chronic Disease." The New England Journal of Medicine 363, no. 1 (2010): 6-9.

United States Census Bureau. American Community Survey, 5-year estimates. 2019.

United States Census Bureau. 2010.

United States Department of Agriculture. "Food Access Research Atlas". 2019. "https://www.ers.usda.gov/data-products/food-access-research-atlas/download-the-data/"
